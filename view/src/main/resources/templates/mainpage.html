<!DOCTYPE html>
<!--[if IE 7]> <html lang="en" class="ie7"> <![endif]-->
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<head>
    <title>VoteEase</title>
    <script src="/js/axios.min.js"></script>
    <script src="/js/api.js"></script>
    <!-- Meta -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <!-- CSS Global Compulsory-->
    <link rel="stylesheet" href="/plugins/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/header.css" />
    <link rel="stylesheet" href="/plugins/bootstrap/css/bootstrap-responsive.min.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/style_responsive.css" />
    <link rel="stylesheet" href="/css/zoom.css" media="all" type='text/css'  /> <!--图片弹出层样式 必要样式-->
    <!--     <link rel="shortcut icon" href="favicon.ico" />      -->
    <!-- CSS Implementing Plugins -->
    <link rel="stylesheet" href="/plugins/font-awesome/css/font-awesome.css" />
    <link href="/plugins/glyphicons/css/glyphicons.css" rel="stylesheet" />
    <!-- CSS pie chart -->
    <link rel="stylesheet" type="text/css" href="/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/css/postbutton.css" />
    <!-- CSS Theme -->
    <!--     <link rel="stylesheet" href="assets/css/themes/default.css" id="style_color" /> -->
    <!--     <link rel="stylesheet" href="assets/css/themes/headers/default.css" id="style_color-header-1" />   -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>

<body>
<!--=== Top ===-->
<div class="top">
    <div id="status" class="container">
        <!-- Unauthenticated state -->
        <div id="unauthenticated" style="display: block;">
            <ul class="loginbar pull-right">
                <li><a href="login" class="login-btn">Login</a></li>
                <li class="divider">&nbsp;</li>
                <li><a href="register" class="login-btn">Register</a></li>
            </ul>
        </div>
        <!-- Authenticated state -->
        <div id="authenticated" style="display: none;">
            <ul class="loginbar pull-right">
                <li><a href="userCenter.html" class="login-btn" style="text-transform: none;">
                    <img class="media-object" src="assets/img/unlogin.png" alt="" /> UserCenter
                </a></li>
                <li class="divider">&nbsp;</li>
                <li><a href="messages" class="login-btn">Messages</a></li>
                <li class="divider">&nbsp;</li>
                <li><a href="#" id="logout-link" class="login-btn">Log out</a></li>
            </ul>
        </div>
    </div>
</div><!--/top-->
<!--=== End Top ===-->


<!--=== Header ===-->
<div class="header margin-bottom-20">
    <div class="container">

        <!-- Menu -->
        <div class="navbar">
            <div class="navbar-inner">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a><!-- /nav-collapse -->
                <div class="nav-collapse collapse">
                    <ul class="nav top-2">
                        <li class="active">
                            <a href="/" class="dropdown-toggle" data-toggle="dropdown">Home
                            </a>
                            <b class="caret-out"></b>
                        </li>
                        <li>
                            <a href="mainpage.html" class="dropdown-toggle" data-toggle="dropdown">Daily life
                            </a>
                            <b class="caret-out"></b>
                        </li>
                        <li>
                            <a href="mainpage.html" class="dropdown-toggle" data-toggle="dropdown">Entertainment
                            </a>
                            <b class="caret-out"></b>
                        </li>
                        <li>
                            <a href="mainpage.html" class="dropdown-toggle" data-toggle="dropdown">Artwork
                            </a>
                            <b class="caret-out"></b>
                        </li>
                        <li>
                            <a href="mainpage.html" class="dropdown-toggle" data-toggle="dropdown">Sport
                            </a>
                            <b class="caret-out"></b>
                        </li>
                        <li>
                            <a href="mainpage.html" class="dropdown-toggle" data-toggle="dropdown">Social Event
                            </a>
                            <b class="caret-out"></b>
                        </li>
                        <li>
                            <a href="mainpage.html" class="dropdown-toggle" data-toggle="dropdown">Fashion
                            </a>
                            <b class="caret-out"></b>
                        </li>
                        <li><a class="search" href="searchResult"><i class="icon-search search-btn"></i></a></li>
                    </ul>
                    <div class="search-open">
                        <div class="input-append">
                            <form />
                            <input type="text" class="span3" placeholder="Search" />
                            <button type="submit" class="btn-u"><a href="searchResult.html" style="color:#fff;">Go</a></button>
                            </form>
                        </div>
                    </div>
                </div><!-- /nav-collapse -->
            </div><!-- /navbar-inner -->
        </div><!-- /navbar -->
    </div><!-- /container -->
</div><!--/header -->
<!--=== End Header ===-->

<!-- Description Section -->
<div id="descriptions">
    <p id="home-desc" class="category-description">Wellcome!</p>
</div>

<!--=== Content Part ===-->
<div class="container">
    <div class="row-fluid blog-page">
        <!-- Left Sidebar -->


        <!-- Right Sidebar -->
        <div class="span3">
            <!-- Posts -->
            <div class="posts margin-bottom-20">
                <div class="wrapper-inner-tab">
                    <div class="wrapper-inner-tab-backgrounds-first"><a href="/post" style="text-decoration:none;"><div class="sim-button button5"><span>Post your question</span></div></a></div>
                </div>
                <div class="headline"><h3>Recent Questions</h3></div>
                <dl class="dl-horizontal">
                    <dt><a href="commentPage.html"><img src="assets/img/sliders/elastislide/6.jpg" alt="" /></a></dt>
                    <dd>
                        <p class="sidebar-contianer"><a href="commentPage.html">question1</a></p>
                    </dd>
                </dl>
                <dl class="dl-horizontal">
                    <dt><a href="commentPage2.html"><img src="assets/img/sliders/elastislide/10.jpg" alt="" /></a></dt>
                    <dd>
                        <p class="sidebar-contianer"><a href="commentPage2.html">question2</a></p>
                    </dd>
                </dl>
                <dl class="dl-horizontal">
                    <dt><a href="commentPage.html"><img src="assets/img/sliders/elastislide/11.jpg" alt="" /></a></dt>
                    <dd>
                        <p class="sidebar-contianer"><a href="commentPage.html">question3</a></p>
                    </dd>
                </dl>
                <dl class="dl-horizontal">
                    <dt><a href="commentPage.html"><img src="assets/img/sliders/elastislide/6.jpg" alt="" /></a></dt>
                    <dd>
                        <p class="sidebar-contianer"><a href="commentPage.html">question4 </a></p>
                    </dd>
                </dl>
                <dl class="dl-horizontal">
                    <dt><a href="commentPage2.html"><img src="assets/img/sliders/elastislide/10.jpg" alt="" /></a></dt>
                    <dd>
                        <p class="sidebar-contianer"><a href="commentPage2.html">question5</a></p>
                    </dd>
                </dl>
                <dl class="dl-horizontal">
                    <dt><a href="commentPage2.html"><img src="assets/img/sliders/elastislide/11.jpg" alt="" /></a></dt>
                    <dd>
                        <p class="sidebar-contianer"><a href="commentPage2.html">question6</a></p>
                    </dd>
                </dl>
            </div><!--/posts-->
        </div><!--/span3-->
    </div><!--/row-fluid-->
</div><!--/container-->
<!--=== End Content Part ===-->

<!--=== Copyright ===-->
<div class="copyright">
    <div class="container">
        <div class="row-fluid">
            <div class="span8">
                <!-- start-copyright -->
                <p>Copyright @ 2024 VoteEase</p>
                <!-- end-copyrigh -->
            </div>
        </div><!--/row-fluid-->
    </div><!--/container-->
</div><!--/copyright-->
<!--=== End Copyright ===-->

<script type="module">
    // Function to check if the user is logged in based on the presence of an auth token.
    function isLoggedIn() {
        const token = localStorage.getItem('authToken');
        console.log('Checking login status:', !!token, 'Token:', token);
        return !!token && token.trim(); // Ensure the token is not just whitespace
    }

    // Function to toggle visibility of authentication states.
    function toggleAuthState() {
        console.log('Toggling authentication state...');
        const unauthenticatedDiv = document.getElementById('unauthenticated');
        const authenticatedDiv = document.getElementById('authenticated');

        if (isLoggedIn()) {
            console.log('User is logged in.');
            unauthenticatedDiv.style.display = 'none';
            authenticatedDiv.style.display = 'block';
        } else {
            console.log('User is not logged in.');
            unauthenticatedDiv.style.display = 'block';
            authenticatedDiv.style.display = 'none';
        }
    }

    // Function to handle logout process.
    async function logout(event) {
        event.preventDefault(); // Prevent default link behavior.

        try {
            // Optionally, you can make a request to your server to invalidate the token.
            // await instance.post('/user/logout'); // Uncomment this line if needed.

            // Remove the token from local storage.
            localStorage.removeItem('authToken');
            console.log('User logged out.');

            // Toggle the authentication state display.
            toggleAuthState();

            // Optionally, you can redirect to a different page or refresh the current one.
            // window.location.reload(); // Uncomment this line if you want to reload the page.
        } catch (error) {
            console.error('Error during logout:', error);
        }
    }

    // Existing login function with added call to toggleAuthState upon successful login.
    async function login(event) {
        event.preventDefault(); // Prevent form's default submit behavior.

        try {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            await instance.post('/user/login', {
                email: email,
                password: password
            }).then(response => {
                if (response.data.code == 0) {
                    alert("success");
                    const token = response.data.data;
                    if (token) {
                        localStorage.setItem('authToken', token);
                        console.log('Token stored successfully:', token);

                        // Debugging: Check if token is being sent in headers
                        console.log('Authorization header:', { authorization: `Bearer ${token}` });

                        toggleAuthState(); // Update nav links after successful login.
                    } else {
                        console.warn('No token received from the server.');
                    }
                } else {
                    throw new Error('Login failed with code: ' + response.data.msg);
                }
            }).catch(error => {
                alert("error");
            });

        } catch (error) {
            console.error('Error during login:', error);
        }
    }

    // Add event listener for logout link
    document.addEventListener('DOMContentLoaded', () => {
        const logoutLink = document.getElementById('logout-link');
        if (logoutLink) {
            logoutLink.addEventListener('click', logout);
        }

        // Initialize the authentication state when the DOM is fully loaded.
        console.log('DOM fully loaded, initializing authentication state...');
        toggleAuthState();
    });

    // Listen for form submission.
    document.addEventListener('DOMContentLoaded', () => {
        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
            loginForm.addEventListener('submit', login);
        }
    });

    // Prevent double submission on "Log in" button click.
    document.addEventListener('DOMContentLoaded', () => {
        const submitButton = document.querySelector('.submit');
        if (submitButton) {
            submitButton.addEventListener('click', function(event) {
                login(event); // Call login function and pass event object.
            });
        }
    });
</script>



</body>
</html>
